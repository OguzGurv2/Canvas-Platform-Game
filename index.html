<!DOCTYPE html5>
<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arena Jumper</title>

<body>
    <section class="container">      
            <div class="canvas-container">
                <canvas id="game-canvas"></canvas>     
            </div>
                <!-- <div class="interface none">
                    <p id="countdown">03:00</p>
                    <div id="health">
                    </div>
                    <p id="score">0</p>
                </div> -->
                <button id="start-button">Start</button>
    </section>
</body>

<style>
    @import url('https://fonts.googleapis.com/css2?family=REM:wght@800&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

    body {
        font-family: 'Raleway', sans-serif;
        font-family: 'REM', sans-serif;
        padding: 0;
        margin: 0;
        border: 0;
    }

    :root {
        --text: #0b090a;
        --background: #f8f6f7;
        --primary: #678378;
        --secondary: #e0d7db;
        --accent: #678378;
    }

    .container {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
    }

    .canvas-container {
        width: 100%;
        max-width: 600px;
        justify-self: center;
    }

    canvas {
        width: 100%;
        height: auto;
        background-color: var(--secondary);
    }

    .interface {
        width: 100px;
        height: 50px;
        color: var(--text);
        display: flex;
        flex-direction: column;
        background: none;  
        position: absolute;
        left: 30%;
    }

    #start-button {
        position: absolute;
        background-color: var(--primary);
        color: var(--secondary);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        height: 50px;
        width: 100px;
        font-family: 'REM', sans-serif;
        justify-self: center;
        align-self: center;
        z-index: 1;
    }

    .interface p {
        margin-block: 5px;
    }

    .none {
        display: none;
    }

    </style>

<script>
    
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext("2d");
    const canvasContainer = document.querySelector('.canvas-container');

    const primary = getComputedStyle(document.documentElement).getPropertyValue('--primary');
    const text = getComputedStyle(document.documentElement).getPropertyValue('--text');
    
    const player = {
        x: (canvasContainer.clientWidth / 2) - 10,
        y: 90,
        width: 15,
        height: 30,
        speedX: 0,
        speedY: 0,
        isJumping: false
    };  
    
    const camera = {
        y: 0,
        x: 0,
        width: canvasContainer.clientWidth,
        height: canvasContainer.clientHeight,
    };

    const moveStrength = 3;
    const jumpStrength = 5;
    const jumpDuration = 10; 
    let jumpFrame = 0; 
    
    const gravity = 0.1;
    
    const platforms = [
        { x: (canvasContainer.clientWidth - 50) / 2, y: 125, width: 25, height: 10 },
        { x: (canvasContainer.clientWidth - 200) / 2, y: 0, width: 25, height: 10 },
        { x: (canvasContainer.clientWidth + 150) / 2, y: -25, width: 50, height: 10 },
        { x: (canvasContainer.clientWidth + 250) / 2, y: -175, width: 25, height: 10 },
        { x: (canvasContainer.clientWidth - 125) / 2, y: -200, width: 25, height: 10 },
        { x: (canvasContainer.clientWidth + 70) / 2, y: -300, width: 50, height: 10 },
        { x: (canvasContainer.clientWidth - 245) / 2, y: -350, width: 25, height: 10 },
        { x: (canvasContainer.clientWidth - 35) / 2, y: -500, width: 25, height: 10 },
        { x: (canvasContainer.clientWidth - 35) / 2, y: -500, width: 25, height: 10 },
        { x: (canvasContainer.clientWidth - 245) / 2, y: -675, width: 25, height: 10 }, 
        { x: (canvasContainer.clientWidth / 2), y: -700, width: 25, height: 10 },
        // { x: canvas.width + 180, y: -800, width: 50, height: 10 },
        // { x: canvas.width - 180 , y: -800, width: 75, height: 10 },
        // { x: canvas.width + 140, y: -950, width: 50, height: 10 },
        // { x: canvas.width + 35, y: -1100, width: 50, height: 10 },
        // { x: canvas.width - 140, y: -1100, width: 75, height: 10 },
        // { x: canvas.width + 140, y: -1200, width: 50, height: 10 },
        // { x: canvas.width + 250, y: -1300, width: 50, height: 10 },
        // { x: canvas.width - 250, y: -1350, width: 75, height: 10 },
    ];
        
    let platformContainer = [];

    // const coins = [
    //     { coinX: canvas.width - 10, coinY: 110, coinRadius: 10, coinStartAngle: 0, coinEndAngle: 2 * Math.PI },
    // ];
    
    const keys = {};
    window.addEventListener('keydown', (event) => {
        keys[event.key] = true;
    });
    
    window.addEventListener('keyup', (event) => {
        keys[event.key] = false;
    });
    
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('orientationchange', resizeCanvas);

    function resizeCanvas() {
        canvas.width = canvasContainer.clientWidth;
        canvas.height = canvasContainer.clientHeight;
    };

    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    function drawPlayer() {
        ctx.fillStyle = text;
        ctx.fillRect(player.x, player.y - camera.y, player.width, player.height);
    };

    function drawPlatforms() {
        ctx.fillStyle = primary;
        platformContainer.forEach(platform => {
            ctx.fillRect(platform.x - camera.x, platform.y - camera.y, platform.width, platform.height);
        });
    };

    // function drawCoins() {
        
    //     coins.forEach(coin => {
    //         ctx.beginPath();
    //         ctx.arc(coin.x - camera.x, coin.y - camera.y, coin.radius, coin.startAngle, coin.endAngle);
    //         ctx.fillStyle = primary;
    //         ctx.fill();
    //         ctx.closePath();
    //     });
    // };

    function checkCollision(rect1, rect2) {
        return rect1.x < rect2.x + rect2.width &&
        rect1.x + rect1.width > rect2.x &&
        rect1.y < rect2.y + rect2.height &&
        rect1.y + rect1.height > rect2.y;
    };

    var lowestPlatform;
    function findLowestPlatform() {
        lowestPlatform = platformContainer.reduce((max, platform) => {
            return platform.y > max ? platform : max;
        }, -Infinity);
    };

    function deletePlatform(platform, index) {
        ctx.clearRect(platform.x, platform.y, platform.width, platform.height);
        platformContainer.splice(index, 1);
    };

    function respawn(platform) {
        player.y = platform.y - 50;
        player.x = platform.x + 15;
        isRunning = true;
    };

    let minValue = Infinity;

    function updateMinValue(newValue) {
        minValue = Math.min(minValue, newValue);
    };

    let countdownDuration = 180000;
    let startTime;
    const countdown = document.querySelector('#countdown');

    let respawnCount = 0;
    var isRunning = false;

    const interface = document.querySelector('.interface');
    const startButton = document.querySelector('#start-button');

    startButton.addEventListener('click', () => {
        resizeCanvas();
        startButton.classList.add('none');
        // interface.classList.remove('none');
        
        isRunning = true;
        player.x = (canvas.width - 35) / 2;
        player.y = 90;
        
        minValue = Infinity;

        platforms.forEach(platform => {
            platformContainer.push(platform);
        });
        
        update();
    });
    
    function gameOver() {
        startButton.classList.remove('none');
        startButton.textContent = 'Play Again';
        
        platformContainer = [];
        
        respawnCount = 0;
    };
    
    function update() {
        clearCanvas();
        drawPlayer();
        drawPlatforms();

        player.speedY += gravity;
        
        player.x += player.speedX;
        player.y += player.speedY;

        camera.y = player.y - canvas.height / 2;

        if (keys['ArrowLeft']) {
            player.speedX = -moveStrength;

        } else if (keys['ArrowRight']) {
            player.speedX = moveStrength;

        } else {
            player.speedX = 0;
        }
        if (player.x < 0) {
            player.x = 0;  
        };
        if (player.x + player.width > canvas.width) {
            player.x = canvas.width - player.width;
        };


        platformContainer.forEach(platform => {
            if (checkCollision(player, platform)) {
                player.isJumping = true;
                jumpFrame = 0;
                player.speedY = -jumpStrength;
            }
        });

        if (player.isJumping && jumpFrame < jumpDuration) {
            player.speedY = -jumpStrength;
            jumpFrame++;
            updateMinValue(player.y);
        } else {
            jumpFrame = 0;
            player.isJumping = false;
        }

        platformContainer.forEach((platform, index) => {
            if ( (camera.height + camera.y) < platform.y) {
                deletePlatform(platform, index);
            }
        });

        if (minValue - ((camera.y - player.y)) < player.y) {
            isRunning = false;
            respawnCount += 1;
            console.log(respawnCount);
            if ( respawnCount < 3 ) {
                respawn(lowestPlatform);
            };
        };

        if (isRunning) {
            requestAnimationFrame(update);
        } else {
            cancelAnimationFrame(update);
            gameOver();
        }

        // drawCoins();
        findLowestPlatform();
    };

    resizeCanvas(); 
</script>

<!-- <svg id="original-svg" class="none" width="100" height="100" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 21.35l-1.45-1.32C5.4 16.36 2 12.28 2 7.77 2 4.42 4.42 2 7.77 2c1.74 0 3.41.81 4.5 2.16C13.83 2.81 15.5 2 17.24 2 20.58 2 23 4.42 23 7.77c0 4.51-3.4 8.59-8.55 12.26L12 21.35z" fill="red"/>
</svg> -->